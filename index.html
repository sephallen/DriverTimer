<!DOCTYPE html>
<html lang="en">
<html>
    <head>
      <!--Import materialize.css-->
      <link type="text/css" rel="stylesheet" href="css/materialize.min.css"  media="screen,projection"/>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
      <title>Driver Timer Settings</title>
    </head>

    <body>

      <div class="container">

        <div class="row">

          <div class="col s12">

            <h3><i class="mdi-action-settings"></i> Driver Timer Settings</h3>

            <div class="card blue-grey darken-1">

              <div class="card-content white-text">

                <span class="card-title">Battery saver mode</span>
                <p>Turning this on removes the seconds display to increase battery life</p>

                <div class="card-action">

                  <form>
                    <p>
                      <input name="seconds_select" type="radio" id="saver_on" value="on"/>
                      <label for="saver_on" class="white-text">On</label>
                    </p>
                    <p>
                      <input name="seconds_select" type="radio" id="saver_off" value="off"/>
                      <label for="saver_off" class="white-text">Off</label>
                    </p>
                  </form>

                </div>

              </div>

            </div>

            <button id="save_button" class="btn waves-effect waves-light">Save</button>

          </div>

        </div>

      </div>

      <!--Import jQuery before materialize.js-->
      <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
      <script type="text/javascript" src="js/materialize.min.js"></script>

      <script>

        $(document).ready(function() {
          var battery = getURLVariable('battery');
          battery = decodeURI(battery);

          // console.log(storedSettings);

          if (battery == 'yes') {
            $('#saver_on').attr('checked', 'checked');
          } else {
            $('#saver_off').attr('checked', 'checked');
          }
        });

        //Setup to allow easy adding more options later
        function saveOptions() {

          var options = {
            "seconds": $('input[name=seconds_select]:checked').val()
          }

          // console.log(options);

          return options;
        };

        var submitButton = document.getElementById("save_button");
        submitButton.addEventListener("click",
        function() {
          console.log("Submit");

          var options = saveOptions();
          var location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(options));

          document.location = location;
        },
        false);

        function getURLVariable(name) {
          name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
          var regexS = "[\\?&]"+name+"=([^&#]*)",
              regex = new RegExp(regexS),
              results = regex.exec(window.location.href);
          if (results == null) return "";
          else return results[1];
        }

      </script>

    </body>
  </html>
